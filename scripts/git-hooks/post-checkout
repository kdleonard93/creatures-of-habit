#!/usr/bin/env bash

# Git post-checkout hook to automatically switch database when changing branches
# This runs after: git checkout, git switch, git pull (when branch changes)

set -e

# Get hook arguments
previous_head=$1
new_head=$2
branch_checkout=$3

# Only run for branch checkouts (not file checkouts)
if [ "$branch_checkout" = "1" ]; then
    echo "üîÑ Branch changed detected, switching database..."
    
    # Run the database branch manager
    cd "$(git rev-parse --show-toplevel)"
    
    # Check if pnpm is available
    if command -v pnpm >/dev/null 2>&1; then
        pnpm db:branch current 2>/dev/null || {
            echo "‚ö†Ô∏è  Database switching failed, but continuing with git checkout"
            echo "   You may need to run 'pnpm db:branch current' manually"
        }
    else
        echo "‚ö†Ô∏è  pnpm not found, skipping automatic database switch"
        echo "   Run 'pnpm db:branch current' after installing dependencies"
    fi
fi
