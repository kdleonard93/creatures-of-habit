#!/usr/bin/env bash

# Git post-merge hook to ensure local DB is migrated after pulling changes
# This covers the case where a pull updates migrations without changing branches.

set -e

echo "üîÑ Post-merge: ensuring local database is up to date..."

# Move to repo root
cd "$(git rev-parse --show-toplevel)"

# Check if pnpm is available
if command -v pnpm >/dev/null 2>&1; then
  pnpm db:branch current 2>/dev/null || {
    echo "‚ö†Ô∏è  Database update failed after merge, but continuing"
    echo "   You may need to run 'pnpm db:branch current' manually"
  }
else
  echo "‚ö†Ô∏è  pnpm not found, skipping automatic database update"
  echo "   Run 'pnpm db:branch current' after installing dependencies"
fi
